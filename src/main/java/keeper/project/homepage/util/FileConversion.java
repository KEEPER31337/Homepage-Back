package keeper.project.homepage.util;

import java.io.BufferedWriter;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;

public class FileConversion {

  public static String byteArrayToBinaryString(byte[] b) {
    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < b.length; ++i) {
      sb.append(byteToBinaryString(b[i]));
    }
    return sb.toString();
  }

  public static String byteToBinaryString(byte n) {
    StringBuilder sb = new StringBuilder("00000000");
    for (int bit = 0; bit < 8; bit++) {
      if (((n >> bit) & 1) > 0) {
        sb.setCharAt(7 - bit, '1');
      }
    }
    return sb.toString();
  }


  public static byte[] binaryStringToByteArray(String s) {
    int count = s.length() / 8;
    byte[] b = new byte[count];
    for (int i = 1; i < count; ++i) {
      String t = s.substring((i - 1) * 8, i * 8);
      b[i - 1] = binaryStringToByte(t);
    }
    return b;
  }


  public static byte binaryStringToByte(String s) {
    byte ret = 0, total = 0;
    for (int i = 0; i < 8; ++i) {
      ret = (s.charAt(7 - i) == '1') ? (byte) (1 << i) : 0;
      total = (byte) (ret | total);
    }
    return total;
  }

  public static String fileToBinaryString(File file) {
    FileInputStream fis = null;
    ByteArrayOutputStream baos = new ByteArrayOutputStream();

    try {
      fis = new FileInputStream(file);
    } catch (FileNotFoundException e) {
      System.out.println("Exception position : FileUtil - fileToString(File file)");
    }

    int len = 0;
    if (file.length() < Integer.MAX_VALUE) {
      throw new IndexOutOfBoundsException("file의 크기가 buffer의 크기 제한보다 큽니다.");
    }
    byte[] buf = new byte[(int) file.length()];
    try {
      while ((len = fis.read(buf)) != -1) {
        baos.write(buf, 0, len);
      }
    } catch (Exception e) {
      e.printStackTrace();
    }

    byte[] fileArray = baos.toByteArray();
    return byteArrayToBinaryString(fileArray);
  }

  public void saveBinaryStringToFile(File file, String binString) {
    /*
     * fileToBinaryString 으로 변환된 String을 다시 file로 복구하고 싶을 때 사용.
     */
    byte[] fileArray = binaryStringToByteArray(binString);
    FileOutputStream fos = null;
    try {
      fos = new FileOutputStream(file);
      fos.write(fileArray);
    } catch (Exception e) {
      System.out.println(
          "Exception position : FileUtil - binaryToFile(String binaryFile, String filePath, String fileName)");
      e.printStackTrace();
    } finally {
      try {
        if (fos != null) {
          fos.close();
        }
      } catch (Exception e) {
        e.printStackTrace();
      }
    }
  }

  public void extractBinaryStringToFile(File file, String binString) {
    /*
     * binary string을 문자열 그대로 파일에 저장.
     * makeSampleJPEGImage 와 같은 sample file 예제를 만들고 싶을 때 사용.
     */
    try {
      BufferedWriter bufferedWriter = new BufferedWriter(new FileWriter(file));
      bufferedWriter.write(binString);
      bufferedWriter.close();
    } catch (Exception e) {
      e.printStackTrace();
    }
  }

  public void makeSampleJPEGImage(String filePath) {
    File file = new File(filePath);
    String binString = "1111111111011000111111111110000000000000000100000100101001000110010010010100011000000000000000010000000100000000000000000000000100000000000000010000000000000000111111111110001000000010001010000100100101000011010000110101111101010000010100100100111101000110010010010100110001000101000000000000000100000001000000000000000000000010000110000000000000000000000000000000000000000100001100000000000000000000011011010110111001110100011100100101001001000111010000100010000001011000010110010101101000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000010110001101110011011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000001111011011010110000000000000000100000000000000000000000000000000110100110010110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001011001000110010101110011011000110000000000000000000000001111000000000000000000000000000001110100011100100101100001011001010110100000000000000000000000010110010000000000000000000000000000010100011001110101100001011001010110100000000000000000000000010111100000000000000000000000000000010100011000100101100001011001010110100000000000000000000000011000110000000000000000000000000000010100011100100101010001010010010000110000000000000000000000011010000000000000000000000000000000101000011001110101010001010010010000110000000000000000000000011010000000000000000000000000000000101000011000100101010001010010010000110000000000000000000000011010000000000000000000000000000000101000011101110111010001110000011101000000000000000000000000011100100000000000000000000000000000010100011000110111000001110010011101000000000000000000000000011101110000000000000000000000000000111100011011010110110001110101011000110000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000011000110010101101110010101010101001100000000000000000000000001011000000000000000000000000000000111000000000001110011000000000101001000000000010001110000000001000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001011000010110010101101000100000000000000000000000000000000000000000000000000000011011111010001000000000000000000011100011110101000000000000000000000011100100000101100001011001010110100010000000000000000000000000000000000000000000000000000001100010100110010000000000000000101101111000010100000000000000000001100011011010010110000101100101011010001000000000000000000000000000000000000000000000000000000010010010100000000000000000000000001111100001000000000000000000101101101100111101110000011000010111001001100001000000000000000000000000000000000000000000000100000000000000000000000000000000100110011001100110000000000000000011110010101001110000000000000000000011010101100100000000000000000001001111010000000000000000000000001010010110110000000000000000000000000000000000000000000000000000000000000000010110000101100101011010001000000000000000000000000000000000000000000000000000001111011011010110000000000000000100000000000000000000000000000000110100110010110101101101011011000111010101100011000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000001100011001010110111001010101010100110000000000000000000000000010000000000000000000000000000000011100000000000100011100000000011011110000000001101111000000000110011100000000011011000000000001100101000000000010000000000000010010010000000001101110000000000110001100000000001011100000000000100000000000000011001000000000001100000000000000110001000000000011011011111111110110110000000001000011000000000000001100000010000000100000001000000010000000100000001100000010000000100000001000000011000000110000001100000011000001000000011000000100000001000000010000000100000001000000100000000110000001100000010100000110000010010000100000001010000010100000100100001000000010010000100100001010000011000000111100001100000010100000101100001110000010110000100100001001000011010001000100001101000011100000111100010000000100000001000100010000000010100000110000010010000100110001001000010000000100110000111100010000000100000001000011111111110110110000000001000011000000010000001100000011000000110000010000000011000001000000100000000100000001000000100000010000000010110000100100001011000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000001000011111111110000000000000000010001000010000000000000000101000000000000010100000011000000010010001000000000000000100001000100000001000000110001000100000001111111111100010000000000000101010000000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100011111111110001000000000000010100000100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111100010000000000000101010000000100000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001110000100111111111110001000000000000010100000100010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111101101000000000000011000000001100000001000000000000001000010001000000110001000100000000001111110000000010011101000000000000011000101010100110111111111111011001";
    saveBinaryStringToFile(file, binString);
  }

}
